const chatContainer = document.getElementById('chatContainer');
const chatForm = document.getElementById('chatForm');
const messageInput = document.getElementById('messageInput');
const loading = document.getElementById('loading');

function addMessage(message, isUser = false, isGenerated = false) {
    const messageDiv = document.createElement('div');
    let className = `message ${isUser ? 'user-message' : 'bot-message'}`;
    if (isGenerated) {
        className += ' generated';
    }
    messageDiv.className = className;
    messageDiv.textContent = message;
    chatContainer.appendChild(messageDiv);
    chatContainer.scrollTop = chatContainer.scrollHeight;
}

function showLoading() {
    loading.style.display = 'block';
}

function hideLoading() {
    loading.style.display = 'none';
}

chatForm.addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const message = messageInput.value.trim();
    if (!message) return;
    
    // Add user message
    addMessage(message, true);
    messageInput.value = '';
    
    // Show loading
    showLoading();
    
    try {
        const formData = new FormData();
        formData.append('message', message);
        
        const response = await fetch('/predict', {
            method: 'POST',
            body: formData
        });
        
                const data = await response.json();
                
                if (data.error) {
                    addMessage(`Error: ${data.error}`);
                } else {
                    // Check if the response is generated by AI
                    const isGenerated = data.intent === 'generated';
                    addMessage(data.response, false, isGenerated);
                }
    } catch (error) {
        addMessage('Sorry, there was an error processing your request.');
        console.error('Error:', error);
    } finally {
        hideLoading();
    }
});

// Focus on input when page loads
messageInput.focus();
